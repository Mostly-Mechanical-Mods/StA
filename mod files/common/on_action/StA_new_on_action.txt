on_game_start_after_lobby = {
	on_actions = {
		StA_title_realm_law_init
	}
}

StA_title_realm_law_init = {
	effect = {
		random_player = {
			create_story = { type = StA_obligation_levels save_scope_as = zero }
			create_story = { type = StA_obligation_levels save_scope_as = one }
			create_story = { type = StA_obligation_levels save_scope_as = two }
			create_story = { type = StA_obligation_levels save_scope_as = three }
			create_story = { type = StA_obligation_levels save_scope_as = four }
			scope:zero = {
				set_variable = { name = flag value = flag:0 }
				set_variable = { name = value value = 0 }
			}
			scope:one = {
				set_variable = { name = flag value = flag:1 }
				set_variable = { name = value value = 1 }
			}
			scope:two = {
				set_variable = { name = flag value = flag:2 }
				set_variable = { name = value value = 2 }
			}
			scope:three = {
				set_variable = { name = flag value = flag:3 }
				set_variable = { name = value value = 3 }
			}
			scope:four = {
				set_variable = { name = flag value = flag:4 }
				set_variable = { name = value value = 4 }
			}
			add_to_global_variable_list = {
				name = StA_obligation_levels
				target = scope:zero
			}
			add_to_global_variable_list = {
				name = StA_obligation_levels
				target = scope:one
			}
			add_to_global_variable_list = {
				name = StA_obligation_levels
				target = scope:two
			}
			add_to_global_variable_list = {
				name = StA_obligation_levels
				target = scope:three
			}
			add_to_global_variable_list = {
				name = StA_obligation_levels
				target = scope:four
			}
		}

		set_global_variable = {
			name = StA_realm_tax
			value = flag:StA_realm_tax
		}
		set_global_variable = {
			name = StA_realm_levies
			value = flag:StA_realm_levies
		}
		add_to_global_variable_list = {
			name = StA_title_tree_obligation
			target = global_var:StA_realm_tax
		}
		add_to_global_variable_list = {
			name = StA_title_tree_obligation
			target = global_var:StA_realm_levies
		}

		set_global_variable = {
			name = 0
			value = 0
		}
		set_global_variable = {
			name = 1
			value = 1
		}
		set_global_variable = {
			name = 2
			value = 2
		}
		set_global_variable = {
			name = 3
			value = 3
		}
		set_global_variable = {
			name = 4
			value = 4
		}
		add_to_global_variable_list = {
			name = tree_obligation
			target = global_var:0
		}
		add_to_global_variable_list = {
			name = tree_obligation
			target = global_var:1
		}
		add_to_global_variable_list = {
			name = tree_obligation
			target = global_var:2
		}
		add_to_global_variable_list = {
			name = tree_obligation
			target = global_var:3
		}
		add_to_global_variable_list = {
			name = tree_obligation
			target = global_var:4
		}
		add_to_global_variable_list = {
			name = boolean_obligation
			target = global_var:0
		}
		add_to_global_variable_list = {
			name = boolean_obligation
			target = global_var:1
		}

		every_ruler = {
			limit = { has_government = feudal_government }
			ordered_held_title = {
				limit = {
					any_this_title_or_de_jure_above = {
						NOR = {
							THIS = PREV
							has_variable = StA_title_realm_law
						}
					}
				}
				order_by = tier
				max = 99
				check_range_bounds = no
				PREV = {
					set_variable = {
						name = StA_title
						value = PREV
					}
					create_story = StA_title_realm_law
				}
			}
			every_vassal = {
				limit = { has_government = feudal_government }
				save_scope_as = StA_init_vassal
				primary_title = {
					ordered_this_title_or_de_jure_above = {
						limit = {
							NOT = { THIS = PREV }
							holder = scope:StA_init_vassal.liege
						}
						order_by = reverse_tier
						scope:StA_init_vassal = {
							set_variable = {
								name = StA_title_allegiance
								value = PREV
							}
						}
					}
				}
				if = {
					limit = { NOT = { has_variable = StA_title_allegiance }}
					set_variable = {
						name = StA_title_allegiance
						value = liege.primary_title
					}
				}
				set_variable = {
					name = StA_custom_contract
					value = no
				}
			}
		}
	}
}